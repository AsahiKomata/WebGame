<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¾…æ©Ÿæ‰€</title>
    <link rel="stylesheet" href="waiting_room_style.css">
    <script src="/socket.io/socket.io.js"></script>
</head>
<body class="waiting-room">
    <div class="container">
        <h1>å¾…æ©Ÿæ‰€</h1>

        <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åå…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  -->
        <div class="input-area">
            <input type="text" id="username" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å…¥åŠ›">
            <button onclick="join()">å‚åŠ </button>
        </div>

        <!-- å‚åŠ ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒªã‚¹ãƒˆ -->
        <h2>ç¾åœ¨ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼</h2>
        <ul id="playerList"></ul>

        <!-- ğŸ‘‡ ç®¡ç†è€…ã ã‘ãŒè¦‹ãˆã‚‹ã‚²ãƒ¼ãƒ é–‹å§‹ãƒœã‚¿ãƒ³ -->
        <button id="startGameBtn" onclick="startGame()" style="display: none;">ã‚²ãƒ¼ãƒ é–‹å§‹</button>
    </div>

    <script>
        const socket = io();
        let isAdmin = false; // ç®¡ç†è€…ã‹ã©ã†ã‹ã‚’åˆ¤å®š
        let isJoined = false; // å‚åŠ æ¸ˆã¿ã‹ã©ã†ã‹åˆ¤å®š
        let username = ""; // ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’ä¿æŒ

        function join() {
            if (isJoined) return; // ã™ã§ã«å‚åŠ ã—ã¦ã„ãŸã‚‰å‡¦ç†ã—ãªã„
        
            const usernameInput = document.getElementById("username");
            const joinButton = document.getElementById("joinButton");

            const username = usernameInput.value;
            if (username) {
                socket.emit("joinWaitingRoom", username);
                isJoined = true; // å‚åŠ æ¸ˆã¿ãƒ•ãƒ©ã‚°ã‚’ç«‹ã¦ã‚‹

                // ğŸ¯ å‚åŠ å¾Œã¯åå‰å¤‰æ›´ä¸å¯ï¼†ãƒœã‚¿ãƒ³ç„¡åŠ¹åŒ–
                usernameInput.disabled = true;
                joinButton.disabled = true;
                //joinButton.style.display = "none"; // å®Œå…¨ã«ãƒœã‚¿ãƒ³ã‚’æ¶ˆã™å ´åˆ
            }
        }

        socket.on("updatePlayerList", (players) => {
            const playerList = document.getElementById("playerList");
            playerList.innerHTML = "";
            players.forEach(player => {
                const li = document.createElement("li");
                li.textContent = player;
                playerList.appendChild(li);
            });
        });

        // ğŸ® ç®¡ç†è€…ã®ã¿ã‚²ãƒ¼ãƒ é–‹å§‹ãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–
        socket.on("setAsAdmin", () => {
            isAdmin = true;
            document.getElementById("startGameBtn").style.display = "block"; // ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
        });

        function startGame() {
            if (isAdmin) {
                socket.emit("startGame");
            } else {
                alert("ç®¡ç†è€…ã®ã¿ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã§ãã¾ã™ï¼");
            }
        }

        socket.on("redirectToGame", () => {
            const username = document.getElementById("username").value;
            if (username) {
                window.location.href = `/game?user=${encodeURIComponent(username)}`;
            }
        });
    </script>
</body>
</html>
